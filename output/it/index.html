<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="description" content="random.choice(['programming', 'gaming', 'stuff'])">
<meta name="viewport" content="width=device-width">
<title>@FPSD | @FPSD</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (it)" href="rss.xml">
<link rel="canonical" href="https://francesco.pischedda.info/it/">
<!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->
</head>
<body>
    <section class="social"><ul>
<li><a href="#" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="../pages/services/" title="Hire me!"><i class="icon-user"></i></a></li>
            <li><a href="https://github.com/fpischedda" title="My Github"><i class="icon-github"></i></a></li>
            <li><a href="https://twitter.com/focaskater" title="Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="https://getnikola.com" title="Powered By Nikola"><i class=""></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
            
        <div class="post">
            <h1 class="title"><a href="posts/my-new-approach-to-software-prototyping-and-the-stack-that-makes-it-possible/">My new approach to software prototyping and the stack that makes it possible</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2020-08-01T10:08:14+02:00">2020-08-01 10:08</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/my-new-approach-to-software-prototyping-and-the-stack-that-makes-it-possible/#disqus_thread" data-disqus-identifier="cache/posts/clojurescript-rum-and-datascript-are-helping-me-to-not-hate-frontend-development.html">Commenti</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tag : 
           <li><a class="tag p-category" href="categories/prototyping-clojurescript-rum-react-datascript-frontend/" rel="tag">prototyping clojurescript rum react datascript frontend</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div class="section" id="foreword">
<h2>Foreword</h2>
<p>In this blog post I am going to illustrate how, during the development of a
pet project, I have changed the way I approach software development and
prototyping, going from "backend first" to "frontend first, backend eventually".
I will also mention the tools that make it possible and even enjoyable for a non
frontend developer.</p>
<div class="section" id="background">
<h3>Background</h3>
<p>At $work I have always spent most of my time in the backend and infrastructure
side of things but sometimes, especially when working on side projects, I have
to go "full stack" and take care of frontend tasks, even if I kind of suck at
it.
For this reason I am always inclined to start with some sort of backend code,
starting with a data model, core business logic and a REST API to (eventually)
build a frontend on top of it...which most of the times means I will lose
interest/momentum and the project dies.</p>
</div>
<div class="section" id="at-some-point-something-clicked">
<h3>At some point something clicked</h3>
<p>One day (probably a lazy Sunday) I had an idea: I want an incredibly stupid
way to collect random thoughts, links or any kind of text blob, I want to own
it, it must live on my VPS and I have to finish it today!
This time thoughts decided to follow a different path:</p>
<ul class="simple">
<li><p>how important what I am going to write here is? can I afford to lose data?</p></li>
<li><p>what if I don't need to store anything in a durable storage?</p></li>
<li><p>ok, aim for least amount of features and see later if I need more</p></li>
</ul>
<p>The outcome is a service that will keep all data in volatile memory, losing it
at each restart and this is perfectly fine for what I needed at that time!
I think this small tool planted the seed for what, I think, will be be my
preferred method for future projects.</p>
<p>What has been so different with development of this tool is that I have tried
and (more or less succeeded) to address the problem at hand without much
ceremony, and it served its purpose quite well.
At some point I've started to add more features "just because" but, at the end
of the day, the core remained the same and now I even want to remove these new
features because they are not adding value but are, effectively, distracting.</p>
</div>
<div class="section" id="next-project">
<h3>Next project</h3>
<p>Fast forward few months, I am again thinking about a new project.
My girlfriend needed/wanted a tool to make it easy to share a watermarked
version of her drawings, even better if the shared link required a password to
access the image.</p>
<p>Compared to the previous project, this one is slightly more complex, especially
the user facing part, but I am confident that if I address the most basic
requirements first, I should be able to give her a rough beta in few hours.
Here are the features I have decided to include in the "MVP":</p>
<ul class="simple">
<li><p>user can upload a file</p></li>
<li><p>user can chose a watermark size</p></li>
<li><p>user can eventually chose a password to protect the image</p></li>
<li><p>once the user clicks "Upload", the system applies the watermark and</p></li>
<li><p>render a page with the list of uploaded/watermarked files, each with a link to it</p></li>
</ul>
<p>So far so good, the tool is there, ugly but working. What if we open this
tool to other people? WOW! We can make our own product! Lets do it!</p>
<p>Armed with great energy I have started working on the new version but this time
I have started building a full featured backend even if, at this point,
is not 100% clear how a user is going to interact with it, how valuable it
could be and all the usual unknowns.
So why I am insisting with the old approach when it showed, multiple times, it
is quite ineffective? I guess it is a matter of habits (because I don't want
to call it stupidity).</p>
</div>
<div class="section" id="a-new-approach">
<h3>A new approach</h3>
<p>I often fail to make progress on my projects when it comes the turn of the
frontend code, after having written most of the backend, maybe this time I
can try the other way around!
Common sense suggests to create mocks of the interface using tools like
<a class="reference external" href="https://balsamiq.com/wireframes">Balsamiq</a>, <a class="reference external" href="https://moqups.com/">Moqups</a> and so on but, for some reasons I am totally unable to
use those kind of tools plus I would like to have a taste of how to UI feels
in the hands a user...what should I do now?</p>
<p>Recently I have started experimenting with <a class="reference external" href="https://www.clojurescript.org">ClojureScript</a> and <a class="reference external" href="https://github.com/tonsky/rum">Rum</a> (a library
that wraps React) and so far I feel quite productive with it, why should I not
use these tools to write the mock? The plan now looks like this:</p>
<ul class="simple">
<li><p>quickly build an ugly but functional UI</p></li>
<li><p>mock the app state/data to reflect what I need in the UI</p></li>
<li><p>understand what feels wrong, get feedback from other people</p></li>
<li><p>plan next iteration</p></li>
<li><p>repeat until happy</p></li>
</ul>
<p>Essential to this approach is the quick feedback loop you can get by using
ClojureScript + Rum (or any other React wrapper like <a class="reference external" href="https://reagent-project.github.io/">Reagent</a>), immutable
persistent data structures and a REPL; I "suspect" that, if we exclude the
REPL, a similar setup can be achieved with other stacks but I am quite happy
with the tools I have chosen.</p>
</div>
<div class="section" id="how-has-it-been-so-far">
<h3>How has it been so far?</h3>
<p>I am not a frontend developer and every time I try to create some sort of UI
I am pretty sure I will fail, lose interest and put the project on hold but,
this time, it has been quite different.
Being able to iterate quickly and having a fast feedback loop, helped me a lot
to proceed at "great speed" and not losing focus.
Each time I wanted to add a new feature or change how a component had to work,
the process has been pretty straightforward:</p>
<ul class="simple">
<li><p>create a new branch</p></li>
<li><p>try out the new idea by small, even tiny iterations with live feedback</p></li>
<li><p>adjust the data model as needed</p></li>
<li><p>repeat</p></li>
<li><p>if happy merge to master otherwise scrap everything and forget</p></li>
</ul>
</div>
<div class="section" id="managing-the-app-state">
<h3>Managing the app state</h3>
<p>One of the points that I would like to spend so time on is the app state.
Even if keeping all the state in one big map is quite handy and flexible,
at some point, it becomes harder and harder to maintain, especially in the
case where there are many ( &gt; 4 or 5) entity types with cross references and
the size of the data gets bigger and bigger; it can still be done but the
state management code starts to get bigger and harder to maintain compared to
the UI code; for my case, the UI code had to know too much about the data model
itself impacting the separation of concerns and this was driving away the focus
on the main goal which is to explore the space of possibilities for the UI I
want to build.</p>
</div>
<div class="section" id="introducing-datascript-into-my-tool-set">
<h3>Introducing Datascript into my tool-set</h3>
<p>With the growing pain of state management I have decided to invest a little bit
of time to find out which solutions are already available in this space and
fortunately I have stepped into <a class="reference external" href="https://github.com/tonsky/datascript">Datascript</a>, an in memory database developed by
the same person who gave us Rum :)
This database has all the features I need plus some more; I am sure that I am
still missing some handy features but so far I have been able to:</p>
<ul class="simple">
<li><p>build a consistent data store</p></li>
<li><p>which supports cross references between entities</p></li>
<li><p>which I can easily query (using Datalog)</p></li>
<li><p>with support to joins</p></li>
</ul>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Datalog">Datalog</a> itself is quite simple even if a bit "alien" until you know how to
use it; instead of writing about it here I prefer to give a link to the best
learning material I have found <a class="reference external" href="http://www.learndatalogtoday.org/">http://www.learndatalogtoday.org/</a>.</p>
<p>Armed with Datascript (for the data store) and Datalog (for the queries) the
UI code can now interact with the app state without knowing much about it!
This is a great relief because now I can focus again on building a UI for my
project and spend the right amount of time (&lt; 5%) on the data store.</p>
<p>Another good point of this approach is that, when the backend will be ready,
it will be a matter of translating what I will get out of its APIs to the
UI's internal data store and everything will continue to work as expected.</p>
</div>
<div class="section" id="summary">
<h3>Summary</h3>
<p>The goal of this post was to write down my current approach to software
development with the hope to start a discussion with other developers which
may be interested to explore and talk about novel methodologies which have
worked great for them.
If by reading this blob of text you are now also curious about ClojureScript
and its ecosystem, I am even more happy!</p>
</div>
<div class="section" id="links">
<h3>Links</h3>
<ul class="simple">
<li><p>ClojureScript: <a class="reference external" href="https://clojurescript.org/">https://clojurescript.org/</a></p></li>
<li><p>Rum: <a class="reference external" href="https://github.com/tonsky/rum">https://github.com/tonsky/rum</a></p></li>
<li><p>DataScript: <a class="reference external" href="https://github.com/tonsky/datascript">https://github.com/tonsky/datascript</a></p></li>
<li><p>Datalog: <a class="reference external" href="https://en.wikipedia.org/wiki/Datalog">https://en.wikipedia.org/wiki/Datalog</a></p></li>
<li><p>Datalog course: <a class="reference external" href="http://www.learndatalogtoday.org/">http://www.learndatalogtoday.org/</a></p></li>
<li><p>Reagent: <a class="reference external" href="https://reagent-project.github.io/">https://reagent-project.github.io/</a></p></li>
<li><p>Balsamiq: <a class="reference external" href="https://balsamiq.com/wireframes">https://balsamiq.com/wireframes</a></p></li>
<li><p>Moqups: <a class="reference external" href="https://moqups.com/">https://moqups.com/</a></p></li>
</ul>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/routing-celery-task-for-simple-prioritization/">Routing Celery task for simple prioritization</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2018-07-15T09:10:22+02:00">2018-07-15 09:10</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/routing-celery-task-for-simple-prioritization/#disqus_thread" data-disqus-identifier="cache/posts/routing-celery-task-for-simple-prioritization.html">Commenti</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tag : 
           <li><a class="tag p-category" href="categories/python-celery-vimcar/" rel="tag">Python Celery Vimcar</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div class="section" id="problem">
<h2>Problem</h2>
<p>Like most businesses, where I <a class="reference external" href="https://www.vimcar.com">work</a> we need to send lots of notifications to our
users, mainly emails and push notifications; the setup is quite simple:</p>
<blockquote>
<ul class="simple">
<li><p>a service accepts requests to send notifications to users</p></li>
<li><p>the notification service prepare the message and put it in a queue</p></li>
<li><p>a pool of workers fetches messages from the queue and perform the actual delivery</p></li>
</ul>
</blockquote>
<p>This works reasonably well and we can scale the service increasing the
instances of the notification service and the delivery workers.</p>
<p>This setup is used also when a user requests an export of her/his historical
data; since this process can take a while, a background job fetches the data,
generates a pdf and sends it via email using the notifications service.
At the same time we generate hundreds of thousands of notifications, usually in
the morning, and this fill up the notifiation queue so if a user requests an
export during this time frame its email will have to wait a lot before it can
be processed.</p>
<div class="section" id="solution">
<h3>Solution</h3>
<dl class="simple">
<dt>We have evaluated a couple of solutions:</dt>
<dd><ul class="simple">
<li><p>per message priority</p></li>
<li><p>dedicated low priority queue for high volume automaticly generated
notifications using task routing</p></li>
</ul></dd>
</dl>
<p>The first solution is a generic one but as far as we have seen it is not easy
to have the guarantie that a high priority message will be delivered in our
desired time frame and we opted for the second solution because we don't need
a fine grained prioritization system (maybe in the future) but just a way to
continue to deliver user generated notifications when we are sending our
automated high volume notifications during the morning.</p>
</div>
<div class="section" id="implementation">
<h3>Implementation</h3>
<dl class="simple">
<dt>Our stack is based on <a class="reference external" href="http://www.celeryproject.org/">Celery</a> and it is composed mainly by two parts:</dt>
<dd><ul class="simple">
<li><p>the notifications service thats send messages to a queue</p></li>
<li><p>a pool of workers that fetch messages from the queue and deliver the
notifications</p></li>
</ul></dd>
</dl>
<p>To achieve our goal we only had to change the way that notifications service
sends messages to the queue by specifing the low or default priority queue based
on the message type and by running a specific pool of workers bound to each
priority queue.</p>
<p>Example code with routing:</p>
<pre class="literal-block">from celery import Celery

celery = Celery()
celery.main = 'Test app'
celery.config_from_object('celeryconfig')
celery.autodiscover_tasks(
    ['tasks'],
    force=True
)


@celery.task
def task(prio, message):
    print(f'{prio}: {message}')

# calling the task specifying the queue
task.apply_async(args=('default', next(generator)),
                 queue='default')</pre>
<dl class="simple">
<dt>How to run a worker specifing the queue::</dt>
<dd>
<p>$ celery -A tasks worker --loglevel=INFO -Q default</p>
</dd>
</dl>
<p>This solution works but there is an efficency problem since when the low
priority queue will be empty the low priority workers will be idle wasting
precious (and paid) resources; fortunately there is a simple solution for this
because it is possible to specify more than one queue using the -Q parameter.
This way we will have a dedicated pool of workers that will work on messages
generated by user activity and a second pool of workers that will handle the
automated messages and, when those will be finished, these workers can help
with default priority messages.</p>
<p>An example implementation is provided in this <a class="reference external" href="https://github.com/fpischedda/celery-routing-example">repo</a> with instruction to run the
different use cases.</p>
<p>P.S.
<a class="reference external" href="https://www.vimcar.com">We</a> are <a class="reference external" href="https://vimcar.de/career/jobs">hiring</a>!</p>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/evaluating-rust-for-game-development/">Evaluating Rust for game development</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2018-05-06T18:19:55+02:00">2018-05-06 18:19</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/evaluating-rust-for-game-development/#disqus_thread" data-disqus-identifier="cache/posts/evaluating-rust-for-game-development.html">Commenti</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tag : 
           <li><a class="tag p-category" href="categories/rust-gamedev-programming/" rel="tag">rust gamedev programming</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div class="section" id="evaluating-rust-for-game-development">
<h2>Evaluating Rust for game development</h2>
<p>There is no doubt that Rust is gaining popularity as a system development
language and most of the time games and game engines are built using languages
such as c or c++ which were born with the same target in mind, being able to
access all the capabilities that a machine has to offer with the minimum
runtime overhead.</p>
<p>In the last years, powerful engines and tools have offered a pletora of bindings
for different languages like C#, Lua, Python, Javascript and so on with great
results; for example Unity have had and continue to have a great success
providing a powerful platform to build game on so why taking the risk and effort
to use such a low level language to build a game?</p>
<p>As an "old school" developer I prefer to be in control of my software development
stack and often, instead of creating the game that I have in mind, I start
creating an engine to build my game on...but why?
That's because it is fun! Or because for some simple game it seems to be easier
to create a small library (or extend some old code) instead of using a powerfull
solution like Unreal Engine, or and or and or...</p>
<p>I have started creating games again and again using high level languages like
Python, Javascript, Lua and even the good old c++; in general I really like to
create prototypes with python but it is not easy to distribute your games and
almost impossible (or reaay hard) to target mobile platforms.
Another option is to target the browser with the growing set of available engines
but again, targeting mobile platforms can be a problem and targeting consoles is
almost impossible.</p>
<p>Rust on the other end is a very young player in the field but with its
ability to target many architectures I think that starting to think about
using it can be a safe bet; there is at least one success story for using rust
for game development and the final result is <cite>encouraging&lt;https://www.rust-lang.org/pdfs/Rust-Chucklefish-Whitepaper.pdf&gt;</cite>.</p>
<div class="section" id="list-of-available-resources">
<h3>List of available resources</h3>
<p>Right now the best collection of rust game development related project can be
found in the "Are we game yet" <cite>page&lt;http://arewegameyet.com/&gt;</cite>.
this web site maintain a list of frameworks and engines fro the lowest level
flavour to the most complete game engine.</p>
<p>Of all the available solutions <cite>ggez&lt;https://github.com/ggez/ggez/&gt;</cite> (Good Game Easy)
is the one which attracts me the most because I like to create small prototypes
and not having the knowledge overhead required by other full featured engines or
frameworks like <cite>piston&lt;https://github.com/PistonDevelopers/piston&gt;</cite> or
<cite>amethyst&lt;https://github.com/amethyst/amethyst&gt;</cite> it is helpful when experimenting;
it also feels like a microframework to which you can add the components you need
without having to comply with other people choices and taste.</p>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/cython-and-c-pointers/">Cython and C pointers</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2017-01-06T16:43:40+01:00">2017-01-06 16:43</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/cython-and-c-pointers/#disqus_thread" data-disqus-identifier="cache/posts/cython-and-c-pointers.html">Commenti</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tag : 
           <li><a class="tag p-category" href="categories/python-cython-c/" rel="tag">python cython c</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p><a class="reference external" href="http://www.cython.org/">Cython</a> is a powerful tool that can speed up your <a class="reference external" href="https://www.python.org/">Python</a> code or can help you
to quickly create an extension module for a library that has c bindings.</p>
<p>This post is not a cython tutorial but its about a problem I have encountered
during the development of a wrapper to Wakaama LWM2M library; if you
want to learn more about <a class="reference external" href="http://www.cython.org/">Cython</a> please refer to its <a class="reference external" href="https://cython.readthedocs.io/en/latest/">documentation</a>.</p>
<p>During the development of said wrapper I have had a nasty strange bug affecting
my code, at some point some object referenced by a pointer kept at the C library
side seemed to change its value! For example think about this situation:</p>
<ul class="simple">
<li><p>you pass an object to a certain c function</p></li>
<li><p>the object's pointer is stored internally by the c library</p></li>
<li><p>you retrieve the object from the c library but its content its not the same...it's not even an instance of the same class!</p></li>
</ul>
<p>To reproduce this behaviour please have a look at overwrite.py in my test <a class="reference external" href="https://github.com/fpischedda/cython-post">project</a>.</p>
<p>At first I've been thinking about memory corruption caused by the C library code;
this wrong assumption costed me at least two days of messing with gdb (that
saved my life in another memory related bug) that have not given any useful
insight.</p>
<p>I don't remember how I've spotted this problem but probably I should have tryed
everything until something pointed me to the right direction.</p>
<p>What seems to happen here is something like this:</p>
<ol class="arabic simple">
<li><p>create an object and assign it to a variable A</p></li>
<li><p>store its pointer in the C library</p></li>
<li><p>get back the pointer of the object; it will be the same object as referenced by A</p></li>
<li><p>assign a new object to A</p></li>
<li><p>create an object assign it to a variable B</p></li>
<li><p>get back the pointer of the object; it will NOT be the same object as
referenced by A but it will be the one referenced by B</p></li>
</ol>
<p>When the variable A is referencing the new object the old one is not referenced
by anyone in the python world and its memory will became available to store the
new object assigned to B and the pointer in the C world is now pointing to what
is referenced by B.</p>
<p>It may seems obvious but when it happened to me it was inside a callback
originating in the C code and being handled by a function defined in the
cython context.</p>
<div class="section" id="lesson-learned">
<h2>Lesson learned</h2>
<p>When working with two different languages together
nothing is naive especially when you are wrapping some code that you don't
really know and that can bite your ass as soon as you think "what can go wrong?"</p>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/the-joy-of-contributing-to-open-sourcefree-software/">The joy of contributing to open source/free software</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-12-29T15:26:08+01:00">2016-12-29 15:26</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/the-joy-of-contributing-to-open-sourcefree-software/#disqus_thread" data-disqus-identifier="cache/posts/the-joy-of-contributing-to-open-sourcefree-software.html">Commenti</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tag : 
           <li><a class="tag p-category" href="categories/free-software-open-source-mozilla/" rel="tag">free software open source mozilla</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>From time to time I like to give back to the community with small patches or
trying to solve issues, sometimes my contribution comes from bugs found while
implementing some kind of software and sometimes I just notice something that
can be fixed or improved.</p>
<p>Usually to process is a kind of cold syntetic handshake between my code and
whatever (D)VCS system used to accept my work but it happens that you will
find some real person at the other side and this is especially true at
Mozilla.</p>
<p>In my opinion Mozilla infrastructure and people are key factors in welcoming new
developers; there are clear documents about the processes which
you will be pointed to by the team and there are real persons that will help you
until you master the procedure.</p>
<div class="section" id="which-are-the-take-aways-of-contributing">
<h2>Which are the take aways of contributing?</h2>
<p>First of all you are forced to read someone else's code; if you work alone or
your employer does not force code reviews this is really helpful because you
are probably going to learn a lot from other sources.</p>
<p>Similarly when contributing to other people's code you are forced to add unit
tests to your patches otherwise your code will not be accepted; this is ideal
in the situations where in your day to day work tests are seens as useless
nerd goodies.</p>
<p>When contributing to bigger projects there is usually a strong procedure that
must be followed; this is not just bureaucracy but it must be seen as a backbone
of the development/deployment/release process. Knowing that any regression
"shall not pass" is a huge boost to your confidence while creating your patch.</p>
<p>And finally people! I think that is the most amazing part of the work; you'll
get to know persons that will teach you something (or maybe the opposite), you
will have to communicate effectively to make your point or just to understand
what problem you are going to fix, increasing your communication skills; oh and
don't we forget the joy of talking to nice people :)</p>
</div>
<div class="section" id="conclusions">
<h2>Conclusions</h2>
<p>Contributing can be a beautiful and useful experience for beginners,
intermediate and senior developers, everyone can learn something while doing
useful work for the community (which in turn will provide a better tools for
yourself too); even if the amount of free time you have at hand is a couple
of hours a week I suggest trying at least to document some software you use or
fix that annoying bug that is driving you crazy, you will thank yourself!</p>
<p>P.S.</p>
<p>I'd like to thank Andrew Halberstadt for his help and his patience while
working on some issues on Mozilla Central repo/bugzilla, thank you Andrew!</p>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/cx_freeze_again/">cx_Freeze, again</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-11-13T21:45:17+01:00">2016-11-13 21:45</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/cx_freeze_again/#disqus_thread" data-disqus-identifier="cache/posts/cx_freeze-again.html">Commenti</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tag : 
           <li><a class="tag p-category" href="categories/cx_freeze-python-pyqt-windows/" rel="tag">cx_Freeze Python PyQT Windows</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div class="section" id="we-meet-again-xz-freeze">
<h2>We meet again, xz_Freeze</h2>
<p>It's been a long time since the last post and for sure I was not thiking about
another post about cx_Freeze.
I have spent this week end trying (and at the end  succeding) to build an
update to an old software. For future memory I'll write briefly the steps needed
to get a functional build without losing my mind.</p>
<div class="section" id="brief-description-of-the-problem">
<h3>Brief description of the problem</h3>
<p>The software is a desktop application used to upload email attachments to a
web based data store; the application talk to the web app using a "RESTy" api,
and fetches the file from a email address; the GUI is written with the beatiful
PyQT5 (someone may prefere PySide) and usually this dependency is a pain to
work with but I have to admit that the newer version installs gracefuly.</p>
</div>
<div class="section" id="os-version-and-things-to-download">
<h3>OS version and things to download</h3>
<p>The person using this software needs to run it from a Windows OS and at this time
Windows 7 is the oldes worsion of the OS I want to support (no Vista, please)
since addressing Windows 10 will produce an executable with no retro compatibily
and Windows 8 have less installs than 7.</p>
<p>The first software needed to be dowloaded is obviusly the Python 3.5 interpreter
and after its installation came the first surprise, it doesn't run because of
some missing dlls; after some research I have downloaded the redistribuitable
runtime and it started to work as expected.</p>
<p>After Python was ready I've had to install the pip utility which was not
automatically installed, maybe I have forgotten to chek the corresponding
option in the installer; anyway everything installed correctly using it, this is
a brief list of dependencies:</p>
<ul class="simple">
<li><p>requests: OK</p></li>
<li><p>paramiko: OK</p></li>
<li><p>imapclient: OK</p></li>
<li><p>PyQT: (surprisingly!) OK</p></li>
<li><p>cx_Freeze: Not ok at all..</p></li>
</ul>
<p>cx_Freeze requires Widonws build tools that can freely (as in beer) downloaded
and installed but even after that I was not able to install it from pip;
fortunately some kind people provided a procompiled wheel for it but be sure
to download the 5.0 version because the 4.x was not able to produce a proper
executable.</p>
</div>
<div class="section" id="additional-dependencies-and-some-setup-py-notes">
<h3>Additional dependencies and some setup.py notes</h3>
<p>Having not touched I tought that the setup script was soemwhat correct since
the last build was succesful, nothing more far from the truth; the first thing
has been a nice surprise, cx_Freeze recognized correctly all the dlls to use in
the final package and referencing additional dlls is not needed anymore, good
work cx_Freeze guys!</p>
<p>After the first build ihave started a cycle of try, fix retry until the
application could as expected, here is a list of additional dependencis that I
had to install and reference in the setup.py file:</p>
<ul class="simple">
<li><p>appdir</p></li>
<li><p>packaging</p></li>
<li><p>atexit</p></li>
</ul>
<p>appdir and atexit only need to be referenced as packages instead packaging
requires some more fine tuining so I had to add this additional sub_packages
to the includes settings of the build_exe_options dictionary:</p>
<ul class="simple">
<li><p>packaging.version</p></li>
<li><p>packaging.specifiers</p></li>
<li><p>packaging.requirements</p></li>
</ul>
</div>
<div class="section" id="final-words">
<h3>Final words</h3>
<p>It took me a couple of hours of trial/error to be able to ship the build and I
hope to not have to repeat this madness again soon; if I'll need to create a new
build in the future I hope that this little post will halp me not to waste my
time again.</p>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/pyqt5-and-cx_freeze-windowstm-target-tips/">PyQT5 and cx_Freeze Windows™ target tips</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-05-02T13:04:54+02:00">2014-05-02 13:04</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/pyqt5-and-cx_freeze-windowstm-target-tips/#disqus_thread" data-disqus-identifier="cache/posts/pyqt5-and-cx_freeze-windowstm-target-tips.html">Commenti</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tag : 
           <li><a class="tag p-category" href="categories/python-pyqt5-cx_freeze-packaging-windows/" rel="tag">python pyqt5 cx_freeze packaging windows</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>One of my preferred benefits of <a class="reference external" href="http://www.python.org">Python</a> is its portability and if coupled
with good libraries such as <a class="reference external" href="http://pyqt.sourceforge.net/Docs/PyQt5/index.html">PyQT5</a> the possibilities are endless.</p>
<p>Now imagine you created a new shiny desktop application and you want to
distribute it, how can you package the app for easy installation?</p>
<div class="section" id="say-hello-to-cx-freeze">
<h2>Say hello to <a class="reference external" href="http://cx-freeze.sourceforge.net">cx_Freeze</a>
</h2>
<p><a class="reference external" href="http://cx-freeze.sourceforge.net">cx_Freeze</a> is a tool that can create a standalone version of your application
so you can easily distribute it and the end user don't have to:</p>
<ul class="simple">
<li><p>download your source code</p></li>
<li><p>a python interpreter</p></li>
<li><p>setup pip or easy_install, libraries and so on</p></li>
</ul>
<p>Another nice feature of <a class="reference external" href="http://cx-freeze.sourceforge.net">cx_Freeze</a> is that it can create an installer for many
different operating systems giving your application a more "professional" look.</p>
<p>I strongly suggest giving it a try; using one of the sample setup scripts
should be enough to get started.</p>
</div>
<div class="section" id="some-minor-issues">
<h2>Some minor issues</h2>
<p>A simple application which only depends on pure python packages usually will
not give you any headaches but if you have dependencies like PyQT5 a bit of
attention is required.
In my case not all the required DLL were included in the installer package and
that generated a strange error message that was very hard to debug but thanks
to sites like <a class="reference external" href="http://www.stackoverflow.com">StackOverflow</a> I've found a nice <a class="reference external" href="http://bit.ly/1kvWVAa">fix</a> for it.
It is worth noting that linked solution is not (always?) enough but there is a
quick solution (at least in my case): add the file libegl.dll to the
"include_files" <a class="reference external" href="http://cx-freeze.sourceforge.net">cx_Freeze</a> building options.</p>
</div>
<div class="section" id="how-to-test-your-shiny-new-installer">
<h2>How to test your shiny new installer</h2>
<p>In order to test your installer and be sure that all the DLLs are incuded and
your application is not "cheating" on you using system DLLs I suggest to create
a clean windows installation inside a virtual machine; this way you can test
your installer in a real case scenario and fix your build scripts accordingly.</p>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/logging-model-changes-with-sqlalchemy-listeners/">Logging model changes with SQLAlchemy listeners</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-12-11T15:33:03+01:00">2013-12-11 15:33</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/logging-model-changes-with-sqlalchemy-listeners/#disqus_thread" data-disqus-identifier="cache/posts/logging-model-changes-with-sqlalchemy-listeners.html">Commenti</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tag : 
           <li><a class="tag p-category" href="categories/python-sqlalchemy/" rel="tag">python sqlalchemy</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div class="section" id="logging-modela-changes-with-sqlalchemy-listeners">
<h2>Logging modela changes with SQLAlchemy listeners</h2>
<div class="section" id="scenario">
<h3>Scenario</h3>
<p>Imagine you have a slew of models in your application, at some point you feel
the need to log somewhere creation, modification or deletion of data belonging
to these models.
How to proceed without having to modify the classes one by one?</p>
</div>
<div class="section" id="what-s-on-sqlalchemy">
<h3>What's on sqlalchemy</h3>
<p>SQLAlchemy (<a class="reference external" href="http://sqlalchemy.org">http://sqlalchemy.org</a>) offers a couple of interesting mechanisms:
the first concerns the possibility to hook to some event listeners such as
before_insert, before_update, before_delete and the corresponding after_*.
Additional help is provided by sqlalchemy the opportunity to work on a model
after its definition by overriding the method __declare_last__.
Using these facts, and assuming that you have defined a model named MyModel,
if we wanted to intercept the event "after_insert" we could write the following
code:</p>
<pre class="code python"><a name="rest_code_62874f6cefc8442c9920518bada0095e-1"></a><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_62874f6cefc8442c9920518bada0095e-2"></a><span class="c1">#lets pretend to have defined our model</span>
<a name="rest_code_62874f6cefc8442c9920518bada0095e-3"></a>
<a name="rest_code_62874f6cefc8442c9920518bada0095e-4"></a>  <span class="k">def</span> <span class="nf">after_insert</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<a name="rest_code_62874f6cefc8442c9920518bada0095e-5"></a>    <span class="c1">#do some stuff</span>
<a name="rest_code_62874f6cefc8442c9920518bada0095e-6"></a>    <span class="k">pass</span>
<a name="rest_code_62874f6cefc8442c9920518bada0095e-7"></a>
<a name="rest_code_62874f6cefc8442c9920518bada0095e-8"></a>  <span class="nd">@classmethod</span>
<a name="rest_code_62874f6cefc8442c9920518bada0095e-9"></a>  <span class="k">def</span> <span class="nf">__declare_last__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a name="rest_code_62874f6cefc8442c9920518bada0095e-10"></a>    <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">cos</span><span class="p">,</span> <span class="s2">"after_insert"</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">after_insert</span><span class="p">)</span>
</pre>
<p>Whenever an object of class MyModel will be entered into the database
after_insert method will be called , passing as parameters the mapping of the
model, the connection and the target is none other than the object that has
just been entered into the database.</p>
<p>In the event that you are intercepting the creation or deletion of an object
is sufficient to access its primary key to identify it in your log, but if we
wanted to know which fields have been modified, with new and old values, as a
result of an update it gets a little more complicated, but not too much.
In fact sqlalchemy allows us, quite easily , to check the status of the fields
of an object using the function sqlalchemy.orm.attributes.get_history (<a class="reference external" href="http://docs.sqlalchemy.org/en/latest/orm/session.html#sqlalchemy.orm.attributes.get_history">http://docs.sqlalchemy.org/en/latest/orm/session.html#sqlalchemy.orm.attributes.get_history</a>).
This function is called for each field, it returns an object of type History (<a class="reference external" href="http://docs.sqlalchemy.org/en/latest/orm/session.html#sqlalchemy.orm.attributes.History">http://docs.sqlalchemy.org/en/latest/orm/session.html#sqlalchemy.orm.attributes.History</a>)
which we will use the method has_changes() to check for changes, and if there were,
getting the new and old values of the field that we are analyzing, for example:</p>
<pre class="code python"><a name="rest_code_18efc29c5f714ac3adc1a9fad1086f30-1"></a><span class="n">h</span> <span class="o">=</span> <span class="n">get_history</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">"a_field"</span><span class="p">)</span>
<a name="rest_code_18efc29c5f714ac3adc1a9fad1086f30-2"></a><span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">has_changes</span><span class="p">():</span>
<a name="rest_code_18efc29c5f714ac3adc1a9fad1086f30-3"></a>  <span class="c1">#do something using h.deleted list to get the old values</span>
<a name="rest_code_18efc29c5f714ac3adc1a9fad1086f30-4"></a>  <span class="c1">#do something using h.added list to get the new values</span>
</pre>
</div>
<div class="section" id="loggablemixin">
<h3>LoggableMixin</h3>
<p>Clearly to do this for all models of an application may be costly in terms of
time and code maintenance (and extremely annoying) so you might think about
creating a generic Mixin with which to extend the models of our application.
Below is the skeleton for the implementation of the above mixin, omitting the
details of where and how the logs are stored:</p>
<pre class="code python"><a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-1"></a><span class="k">class</span> <span class="nc">LoggableMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-2"></a>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-3"></a>  <span class="k">def</span> <span class="nf">after_insert</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-4"></a>    <span class="c1">#do some stuff for the insert</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-5"></a>    <span class="k">pass</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-6"></a>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-7"></a>  <span class="k">def</span> <span class="nf">after_update</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-8"></a>    <span class="c1">#do some stuff for the update, maybe saving the changed fields values using get_history</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-9"></a>    <span class="k">pass</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-10"></a>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-11"></a>  <span class="k">def</span> <span class="nf">after_delete</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-12"></a>    <span class="c1">#do some stuff</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-13"></a>    <span class="k">pass</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-14"></a>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-15"></a>  <span class="nd">@classmethod</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-16"></a>  <span class="k">def</span> <span class="nf">__declare_last__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-17"></a>    <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">cos</span><span class="p">,</span> <span class="s2">"after_insert"</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">after_insert</span><span class="p">)</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-18"></a>    <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">cos</span><span class="p">,</span> <span class="s2">"after_update"</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">after_update</span><span class="p">)</span>
<a name="rest_code_35d319a097a64798835c8c3e86b7bd7a-19"></a>    <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">cos</span><span class="p">,</span> <span class="s2">"after_delete"</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">after_delete</span><span class="p">)</span>
</pre>
<p>so, for each model we want to log changes it will be sufficient to inherit from LoggableMixin:</p>
<pre class="code python"><a name="rest_code_2490dce6ab7646bfb0d392c4cfd38ce5-1"></a><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">SomeSuperClass</span><span class="p">,</span> <span class="n">LoggableMixin</span><span class="p">):</span>
<a name="rest_code_2490dce6ab7646bfb0d392c4cfd38ce5-2"></a>  <span class="k">pass</span>
</pre>
</div>
<div class="section" id="improvements">
<h3>Improvements</h3>
<p>One of the first improvements you can make to the class LoggableMixin could be
the separation of the class in three different classes eg . LogInsertMixin, LogUpdateMixin LogDeleteMixin,
in my case I preferred to have it all together given the small size of the class.
A second improvement would be the generalization of mixin allowing you to
specify which functions (or methods) to be assigned to different listeners,
and once more the specific needs of the application I'm working on does not
require this level of abstraction and can live well with this approach.</p>
</div>
<div class="section" id="conclusions">
<h3>Conclusions</h3>
<p>SQLAlchemy provides a number of services to work with the model, the system
just described would not have been so easy to implement if it were not for the
quality of the API of sqlalchemy.
I invite anyone to go deeper in the documentation for sqlalchemy (<a class="reference external" href="http://docs.sqlalchemy.org">http://docs.sqlalchemy.org</a>)
because within it are preserved gems of great value.
For those wishing to see a concrete implementation of the topics discussed in
this post they can take a look at the file sysgrove/models.py in the repository
at <a class="reference external" href="https://bitbucket.org/sysgrove/sysgrove">https://bitbucket.org/sysgrove/sysgrove</a></p>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/our-qt-date-picker/">Our QT date picker</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-12-10T21:52:42+01:00">2013-12-10 21:52</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/our-qt-date-picker/#disqus_thread" data-disqus-identifier="cache/posts/our-qt-date-picker.html">Commenti</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tag : 
           <li><a class="tag p-category" href="categories/pyqt-python-datepicker/" rel="tag">pyqt python datepicker</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div class="section" id="our-qt-date-picker">
<h2>Our QT date picker</h2>
<p>One of the first works carried out just entering at SysGrove (<a class="reference external" href="http://sysgrove.com">http://sysgrove.com</a> )
consisted in rewriting the date picker component in our application and
requests regarding this component was that it was similar, at least as a
feature, to the date picker available in windows 7 ™. The most interesting
aspect of this component is the ability to be able to do some sort of zoom
dates, I try to explain with an example:</p>
<ul class="simple">
<li><p>It would be a classic date picker where are the days of the current month and
the ability to change the month with the classic arrows</p></li>
<li><p>Clicking on the button in the middle of the arrows the days are replaced by
months and the arrows will change the current year</p></li>
<li><p>Again by clicking on the button in the middle of the arrows months will be
replaced by the years and the arrows will change the decade</p></li>
<li><p>Selecting a year will return a month view and by selecting a month will
return a day view</p></li>
</ul>
<p>Some images could help to understand the behaviour:</p>
<div class="figure">
<img alt="day selector" src="../images/qt-calendar/date-picker-day.png"><p class="caption">The day selector, with month changer arrows; if you click the middle button
you'll see the month selector.</p>
</div>
<div class="figure">
<img alt="/images/qt-calendar/date-picker-month.png" src="../images/qt-calendar/date-picker-month.png"><p class="caption">The month selector, if you click on the middle button you'll see the year
selector.</p>
</div>
<div class="figure">
<img alt="/images/qt-calendar/date-picker-year.png" src="../images/qt-calendar/date-picker-year.png"><p class="caption">The selector selector.</p>
</div>
<p>Fortunately SysGrove is a company that believes strongly in open source and
sharing so I got permission to release this as open source project component,
nice! :)</p>
<p>At present the appearance of the component is not that great and you have to
put hand to customize the code of the component , in the future I hope to be
able to allow the customization of the graphical component directly in the
process of creating an instance rather than in its base code.</p>
<p>The source of this component for the moment can be found in the main repository
of our application ( <a class="reference external" href="https://bitbucket.org/sysgrove/sysgrove">https://bitbucket.org/sysgrove/sysgrove</a> ) path sysgrove /
ui / classes / widgets / calendar.py</p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/using-buildbot-at-sysgrove/">Using buildbot at SysGrove</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-12-10T21:25:11+01:00">2013-12-10 21:25</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/using-buildbot-at-sysgrove/#disqus_thread" data-disqus-identifier="cache/posts/using-buildbot-at-sysgrove.html">Commenti</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tag : 
           <li><a class="tag p-category" href="categories/buildbot-ci-python/" rel="tag">buildbot CI python</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div class="section" id="buildbot-at-sysgrove">
<h2>Buildbot at SysGrove</h2>
<div class="section" id="what-is-buildbot">
<h3>What is buildbot</h3>
<p>BuildBot (<a class="reference external" href="http://buildbot.net/">http://buildbot.net/</a>) is a framework created to simplify the
development of automation solutions in the field of software development.
Unlike other systems such as Jenkins (<a class="reference external" href="http://jenkins-ci.org/">http://jenkins-ci.org/</a>) or TravisCI
(<a class="reference external" href="https://travis-ci.org/">https://travis-ci.org/</a>) buildbot only provides a framework on which to build
the infrastructure that you need .
The project has client-server architecture where the server sends to the client
the work to be performed, the server is called master and the clients are
called slaves; the framework supports multiple masters and multiple slaves, in
this way the system architecture can easily grow with the needs of your
project.
Buildbot is available for virtually any platform, even if the current version
0.8.x platform support win32-64 is not exactly the best though still usable
with some changes (see <a class="reference external" href="http://trac.buildbot.net/wiki/RunningBuildbotOnWindows">http://trac.buildbot.net/wiki/RunningBuildbotOnWindows</a> )</p>
<div class="section" id="id1">
<h4>Buildbot at sysgrove</h4>
<p>For our development needs in SysGrove( <a class="reference external" href="http://sysgrove.com">http://sysgrove.com</a>) buildbot is used to
generate the release of our application for the win32 platform. Every 12 hours
we verify that there are some changes in our repository
(<a class="reference external" href="https://bitbucket.org/sysgrove/sysgrove">https://bitbucket.org/sysgrove/sysgrove</a>) and in this case, the following
operations are performed:
- Download the project from the repository (we use git, but the system supports hg, svn, bazaar etc ...)
- Launch the test suite (in this case we use the testing tool discovery nosetests)
- Generate the executable using py2exe
- Build the initial database (sqlite and postgres)
- It creates the archive with the application executable and test database(s)
- Load the new release on "Confluence"</p>
<p>Clearly doing all these steps manually is tedious and can beprone to errors
or oversights that would decrease the quality of our product.</p>
</div>
<div class="section" id="our-setup">
<h4>Our setup</h4>
<p>As mentioned at the beginning we (<a class="reference external" href="http://sysgrove.com/">http://sysgrove.com/</a>) need to create an
executable for the platform win32 (and possibly in the future for linux and
osx) for which we need to run our script inside a win32 OS; given the relative
difficulty of configuring a master on windows it was decided to have the master
in a linux host (debian jessie) and a slave in a virtual machine
with windows 7 ™ since that the slaves give far fewer problems .</p>
</div>
<div class="section" id="configuration">
<h4>Configuration</h4>
<p>The configuration file, as with cfg extension, is a simple python script, you
can use this file to configure these main areas:
- Slaves: you can define how many slaves you want each with its own identity
- The scheduler: the scheduler indicate how and when the activities will be planned by the master
- The builder: indicate the steps to take to create a build
- Notifiers: the master can communicate in many ways the status of the build such as irc, email or web
- Various configurations such as the database to use to store the state of the system, the identity of the project (name, url) etc.</p>
</div>
<div class="section" id="pitfalls">
<h4>Pitfalls</h4>
<p>As I said earlier I had some problems with windows, probably due to my
inexperience with the version of python for this operating system.
One of the first difficulty concerns sqlalchemy, an ORM for python; buildbot
requires in fact a version of sqlalchemy == 0.7.10 as our application requires
a newer version.
Typically, such a problem is solved easily using the handy tool
virtualenv (<a class="reference external" href="https://pypi.python.org/pypi/virtualenv">https://pypi.python.org/pypi/virtualenv</a>) creating an environment
for the master (the part that needs access to a db, sqlite by default) and one
environment for the slave, but given my experience with windows, I could not
separate the environments (which is why the master is on a debian host and
the slave is a on windows VM).</p>
</div>
<div class="section" id="conclusions">
<h4>Conclusions</h4>
<p>Once you understand the general concepts of buildbot, extend and customize the
functionality becomes simply a work of configuring and creating scripts that do
the real work, besides the web interface by default enables us to keep track of
our builds and forcing new if it were needed.</p>
<p>Clearly this is not a "point and click" tool to everyone and this is a good
thing, in my humble opinion and responsibility for the maintenance of such
a system requires knowledge of a typical IT department and not a manager who,
if desired, can always send us an email to request a build rather than messing
around with his hands no expert ;)</p>
</div>
</div>
</div>
            </div>
        </div>
    
        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-1.html" rel="next">Articoli precedenti</a>
            </li>
        </ul></nav><script>var disqus_shortname="fpsd";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2020         <a href="mailto:francesco@pischedda.info">Francesco "fpsd" Pischedda</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="../assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
