<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="random.choice(['programming', 'gaming', 'stuff'])">
<meta name="viewport" content="width=device-width">
<title>@FPSD (old posts, page 1) | @FPSD</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (it)" href="it/rss.xml">
<link rel="canonical" href="https://francesco.pischedda.info/index-1.html">
<!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->
</head>
<body>
    <section class="social"><ul>
<li><a href="index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="pages/services/" title="Hire me!"><i class="icon-user"></i></a></li>
            <li><a href="https://github.com/fpischedda" title="My Github"><i class="icon-github"></i></a></li>
            <li><a href="https://twitter.com/focaskater" title="Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="https://getnikola.com" title="Powered By Nikola"><i class=""></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
            
        <div class="post">
            <h1 class="title"><a href="posts/using-buildbot-at-sysgrove/">Using buildbot at SysGrove</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-12-10T21:25:11+01:00">2013-12-10 21:25</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/using-buildbot-at-sysgrove/#disqus_thread" data-disqus-identifier="cache/posts/using-buildbot-at-sysgrove.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/buildbot-ci-python/" rel="tag">buildbot CI python</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div class="section" id="buildbot-at-sysgrove">
<h2>Buildbot at SysGrove</h2>
<div class="section" id="what-is-buildbot">
<h3>What is buildbot</h3>
<p>BuildBot (<a class="reference external" href="http://buildbot.net/">http://buildbot.net/</a>) is a framework created to simplify the
development of automation solutions in the field of software development.
Unlike other systems such as Jenkins (<a class="reference external" href="http://jenkins-ci.org/">http://jenkins-ci.org/</a>) or TravisCI
(<a class="reference external" href="https://travis-ci.org/">https://travis-ci.org/</a>) buildbot only provides a framework on which to build
the infrastructure that you need .
The project has client-server architecture where the server sends to the client
the work to be performed, the server is called master and the clients are
called slaves; the framework supports multiple masters and multiple slaves, in
this way the system architecture can easily grow with the needs of your
project.
Buildbot is available for virtually any platform, even if the current version
0.8.x platform support win32-64 is not exactly the best though still usable
with some changes (see <a class="reference external" href="http://trac.buildbot.net/wiki/RunningBuildbotOnWindows">http://trac.buildbot.net/wiki/RunningBuildbotOnWindows</a> )</p>
<div class="section" id="id1">
<h4>Buildbot at sysgrove</h4>
<p>For our development needs in SysGrove( <a class="reference external" href="http://sysgrove.com">http://sysgrove.com</a>) buildbot is used to
generate the release of our application for the win32 platform. Every 12 hours
we verify that there are some changes in our repository
(<a class="reference external" href="https://bitbucket.org/sysgrove/sysgrove">https://bitbucket.org/sysgrove/sysgrove</a>) and in this case, the following
operations are performed:
- Download the project from the repository (we use git, but the system supports hg, svn, bazaar etc ...)
- Launch the test suite (in this case we use the testing tool discovery nosetests)
- Generate the executable using py2exe
- Build the initial database (sqlite and postgres)
- It creates the archive with the application executable and test database(s)
- Load the new release on "Confluence"</p>
<p>Clearly doing all these steps manually is tedious and can beprone to errors
or oversights that would decrease the quality of our product.</p>
</div>
<div class="section" id="our-setup">
<h4>Our setup</h4>
<p>As mentioned at the beginning we (<a class="reference external" href="http://sysgrove.com/">http://sysgrove.com/</a>) need to create an
executable for the platform win32 (and possibly in the future for linux and
osx) for which we need to run our script inside a win32 OS; given the relative
difficulty of configuring a master on windows it was decided to have the master
in a linux host (debian jessie) and a slave in a virtual machine
with windows 7 ™ since that the slaves give far fewer problems .</p>
</div>
<div class="section" id="configuration">
<h4>Configuration</h4>
<p>The configuration file, as with cfg extension, is a simple python script, you
can use this file to configure these main areas:
- Slaves: you can define how many slaves you want each with its own identity
- The scheduler: the scheduler indicate how and when the activities will be planned by the master
- The builder: indicate the steps to take to create a build
- Notifiers: the master can communicate in many ways the status of the build such as irc, email or web
- Various configurations such as the database to use to store the state of the system, the identity of the project (name, url) etc.</p>
</div>
<div class="section" id="pitfalls">
<h4>Pitfalls</h4>
<p>As I said earlier I had some problems with windows, probably due to my
inexperience with the version of python for this operating system.
One of the first difficulty concerns sqlalchemy, an ORM for python; buildbot
requires in fact a version of sqlalchemy == 0.7.10 as our application requires
a newer version.
Typically, such a problem is solved easily using the handy tool
virtualenv (<a class="reference external" href="https://pypi.python.org/pypi/virtualenv">https://pypi.python.org/pypi/virtualenv</a>) creating an environment
for the master (the part that needs access to a db, sqlite by default) and one
environment for the slave, but given my experience with windows, I could not
separate the environments (which is why the master is on a debian host and
the slave is a on windows VM).</p>
</div>
<div class="section" id="conclusions">
<h4>Conclusions</h4>
<p>Once you understand the general concepts of buildbot, extend and customize the
functionality becomes simply a work of configuring and creating scripts that do
the real work, besides the web interface by default enables us to keep track of
our builds and forcing new if it were needed.</p>
<p>Clearly this is not a "point and click" tool to everyone and this is a good
thing, in my humble opinion and responsibility for the maintenance of such
a system requires knowledge of a typical IT department and not a manager who,
if desired, can always send us an email to request a build rather than messing
around with his hands no expert ;)</p>
</div>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/having-fun-with-rabbitmq/">Having fun with RabbitMQ</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-02-28T21:13:45+01:00">2013-02-28 21:13</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/having-fun-with-rabbitmq/#disqus_thread" data-disqus-identifier="cache/posts/having-fun-with-rabbitmq.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/rabbitmq-scaling/" rel="tag">rabbitmq scaling</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div class="section" id="exploring-distributed-calculation-with-rabbitmq">
<h2>Exploring Distributed Calculation With RabbitMQ</h2>
<div class="section" id="preface">
<h3>Preface</h3>
<p>Lately I’ve had to work on a complex web application which have started to have
an increased (and increasing) number of users.
Unfortunately this web application was not built to scale and so problems
started to get to the surface.
When the user base was small to medium the load on the application server was
fairly low and we could focus on adding new features and growing our user base
until we landed on the Facebook platform.
At some point users started to came and the scheduled task took 10-20-40-70-90
minutues to complete leaving the users to stare at the “calculating tasks” page.</p>
<p>The first approved (the correct word should be "imposed") solution was to
migrate our servers to AWS so we could increase host perfomance using bigger
and bigger servers until we reached the limits of the single machine again.</p>
<p>After a lot of battling with the management we had the opportunity to detach
the application core from the web site and started to build the new architecture
with these loosely defined requirements:</p>
<ul class="simple">
<li><p>better use of resources</p></li>
<li><p>better code organization and quality</p></li>
<li><p>horizontal scaling</p></li>
<li><p>manageabilty</p></li>
<li><p>ready for future development</p></li>
</ul>
<p>I admit that those where my requirements, but the management undestood that they
have lost the ability to understand the architecture beyhond a simple web site
with a bounch of scheduled routines that, honestly, worked with the help of an
infinite dose of luck…and also my prototype run in a fraction of time.</p>
</div>
<div class="section" id="building-blocks">
<h3>Building blocks</h3>
<p>Our old backend has been broken in to those pieces:</p>
<ul class="simple">
<li><p>libcore : the base code extracted from the old and stinky web site</p></li>
<li><p>RabbitMQ message broker</p></li>
<li><p>job scheduler : send messages to appropriate exchanges at appropriate time</p></li>
<li><p>workers : consume messages sent by the scheduler</p></li>
</ul>
<p>Leaving libcore apart doing its stuff lets focus on the scheduler and the
workers; for details about RabbitMQ please refer to its web site
(<a class="reference external" href="http://www.rabbitmq.com/">http://www.rabbitmq.com/</a>).</p>
<p>As a scheduling library I have choosen the open source Quartz.NET
(<a class="reference external" href="http://quartznet.sourceforge.net/">http://quartznet.sourceforge.net/</a>) which provided a simple but powerful
interface to schedule jobs, I especially liked the ability to specify job
triggers with the well known and compact cron syntax.
Long story short the scheduled jobs harvests the tasks and send messages to
exchanges accordingly.
I think that the whole core plus the jobs are not bigger than some hundreds of
lines of code. Wonderful!</p>
<p>In order to create a worker one should simply have to inherit from a
BaseConsumer class and override the "consume" method to do its tasks when a
message is received. Done. Cool :)</p>
</div>
<div class="section" id="conclusion">
<h3>Conclusion</h3>
<p>Given this simple architecture what are the benefits? Lets see:</p>
<ul class="simple">
<li><p>scaling: I simply have to add more workers in the same or different machines and the calculating power will increase accordingly</p></li>
<li><p>flexibility: if a new task is required I have to create a new scheduled job and its consumer (even in a different language or platform) and maybe a new message type (messages are simple JSON described objects); after all is tested I have to update the scheduler and add a new worker either by updating a running worker or adding a new one without affecting the whole system; yes it can be done while the system is crunching its task and yes, obviously without affecting the web site(s)</p></li>
<li><p>cost effective: if we have a lot of task to complete at a certain hour in the day I could simply turn on a couple of more machines when I need it and turn those off when the whole work is completed; if you have ever used the Amazon AWS infrastructure you understand of much one can save using this approach</p></li>
<li><p>testing: having everything well separated I can test each block individually instead of having a code blob that is barely manageable</p></li>
</ul>
<p>With this short post I hope to increase interest in this simple way of doing
distribuited computing using a message broker and a simple but well architected
system.</p>
</div>
</div>
            </div>
        </div>
    
        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="." rel="prev">Newer posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="fpsd";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2020         <a href="mailto:francesco@pischedda.info">Francesco "fpsd" Pischedda</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
